<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Stats</title>
    <style>
        /* Reset default styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Custom CSS for widget */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .widget-container {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            width: 400px;
            text-align: center;
            transition: box-shadow 0.3s ease;
        }

        .widget-container:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .overview {
            text-align: left;
            margin-top: 20px;
        }

        .overview p {
            margin-bottom: 10px;
        }

        .top-libraries {
            margin-top: 20px;
            text-align: left;

        }

        .top-libraries h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #333;
        }

        .top-libraries ol {
            list-style: none;
            padding: 0;
        }

        .top-libraries li {
            font-size: 1rem;
            line-height: 1.4;
        }

        .top-libraries li:before {
            content: "\2022"; /* Bullet point (â€¢) as list item marker */
            color: #333; /* Bullet color */
            font-size: 1.2rem;
            display: inline-block;
            width: 1em;
        }

        select {
            width: 100%;
            padding: 10px;
            font-size: 1rem;
            margin-top: 15px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
            transition: border-color 0.3s ease;
        }

        select:hover, select:focus {
            border-color: #aaa;
        }

        .repo-info {
            display: none; /* Hide by default */
            margin-top: 15px;
            text-align: left;
        }

        .repo-info p {
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .repo-info h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="widget-container">
        <h2>Python Stats</h2>
        <select id="repo-selector">
            <option value="">Overview</option>
            <!-- Populate dropdown options dynamically with JavaScript -->
        </select>

        <div id="repo-details" class="repo-info">
            <h3>Repository Details</h3>
            <p id="repo-name"></p>
            <p id="python-files"></p>
            <p id="libraries"></p>
            <p id="total-lines"></p>
        </div>

        <div class="overview" id="lifetime-overview">
            <h3>Lifetime Overview</h3>
            <p><strong>Total Python Files:</strong> <span id="total-python-files"></span></p>
            <p><strong>Total Python Lines:</strong> <span id="total-python-lines"></span></p>
            <p><strong>Total Unique Libraries:</strong> <span id="total-unique-libraries"></span></p>
        </div>

        <div class="top-libraries" id="top-libraries">
            <h3>Top 10 Libraries Used</h3>
            <ol id="top-libraries-list">
                <!-- Top libraries will be populated dynamically -->
            </ol>
        </div>
    </div>

    <script>
        // Load and process repo_data.json
        fetch('repo_data.json')
            .then(response => response.json())
            .then(data => {
                const repoSelector = document.getElementById('repo-selector');
                const repoDetailsContainer = document.getElementById('repo-details');
                const lifetimeOverview = document.getElementById('lifetime-overview');
                const topLibraries = document.getElementById('top-libraries');

                // Populate dropdown options
                data.forEach(repo => {
                    // Only add repositories with Python files
                    if (repo.python_files.length > 0) {
                        const option = document.createElement('option');
                        option.value = repo.repo_name;
                        option.textContent = repo.repo_name;
                        repoSelector.appendChild(option);
                    }
                });

                // Event listener for dropdown change
                repoSelector.addEventListener('change', function() {
                    const selectedRepo = this.value;
                    const selectedRepoData = data.find(repo => repo.repo_name === selectedRepo);

                    // Display repo details if selected
                    if (selectedRepoData) {
                        document.getElementById('repo-name').textContent = `Repository Name: ${selectedRepoData.repo_name}`;
                        document.getElementById('python-files').textContent = `Python Files: ${selectedRepoData.python_files.length}`;
                        document.getElementById('libraries').textContent = `Libraries Used: ${selectedRepoData.libraries.join(', ')}`;
                        document.getElementById('total-lines').textContent = `Total Python Lines: ${selectedRepoData.total_python_lines}`;
                        repoDetailsContainer.style.display = 'block';
                        lifetimeOverview.style.display = 'none'; // Hide lifetime overview when a repo is selected
                        topLibraries.style.display = 'none'; // Hide top 10 libraries when a repo is selected
                    } else {
                        repoDetailsContainer.style.display = 'none';
                        lifetimeOverview.style.display = 'block'; // Show lifetime overview when no repo is selected
                        topLibraries.style.display = 'block'; // Show top 10 libraries when no repo is selected
                    }
                });

                // Calculate lifetime overview
                let totalPythonFiles = 0;
                let totalPythonLines = 0;
                const allLibraries = [];
                const excludedLibraries = ['time', 'random']; // Libraries to exclude

                // Calculate total Python files and lines, and collect all libraries
                data.forEach(repo => {
                    totalPythonFiles += repo.python_files.length;
                    totalPythonLines += repo.total_python_lines;
                    repo.libraries.forEach(library => {
                        if (!allLibraries.includes(library) && !excludedLibraries.includes(library)) {
                            allLibraries.push(library);
                        }
                    });
                });

                // Display lifetime overview initially
                document.getElementById('total-python-files').textContent = totalPythonFiles;
                document.getElementById('total-python-lines').textContent = totalPythonLines;
                document.getElementById('total-unique-libraries').textContent = allLibraries.length;

                // Count occurrences of each library
                const libraryCounts = {};
                data.forEach(repo => {
                    repo.libraries.forEach(library => {
                        if (!excludedLibraries.includes(library)) {
                            if (libraryCounts[library]) {
                                libraryCounts[library]++;
                            } else {
                                libraryCounts[library] = 1;
                            }
                        }
                    });
                });

                // Sort libraries by count in descending order
                const sortedLibraries = Object.keys(libraryCounts).sort((a, b) => libraryCounts[b] - libraryCounts[a]);

                // Display top 10 libraries (excluding excludedLibraries)
                const topLibrariesList = document.getElementById('top-libraries-list');
                let displayedCount = 0;
                sortedLibraries.forEach((library, index) => {
                    if (!excludedLibraries.includes(library) && displayedCount < 10) {
                        const listItem = document.createElement('li');
                        listItem.textContent = `${library} (${libraryCounts[library]} times)`;
                        topLibrariesList.appendChild(listItem);
                        displayedCount++;
                    }
                });
            })
            .catch(error => console.error('Error fetching JSON data:', error));
    </script>
</body>
</html>
